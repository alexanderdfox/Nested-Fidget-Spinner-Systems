<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Maxwell's Demon - Stereo Audio Simulation</title>
<style>
	body { margin:0; background: #0B1020; color: #E6EEF8; font-family: Arial, sans-serif; }
	canvas { display:block; margin:0 auto; background:#0B1020; }
	#panel { position:absolute; top:10px; left:10px; width:280px; padding:10px; background:#141E2D; border-radius:6px; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="panel"></div>
<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const WIDTH = canvas.width;
const HEIGHT = canvas.height;
const CENTER = {x: WIDTH/2, y: HEIGHT/2};
const FPS = 30;
const NUM_LOBES = 3;
const PARTICLES_PER_LOBE = 6;
const BASE_FREQUENCIES = [220, 330, 440]; // Hz for each lobe
const LOBE_COLORS = ['#FF6B6B', '#FFD93D', '#6BE36B'];
const LOBE_PANS = [0.1, 0.5, 0.9]; // stereo position: 0.0=left, 1.0=right

// ------------------- Audio Setup -------------------
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(frequency, volume=0.5, pan=0.5, duration=0.05) {
	const oscillator = audioCtx.createOscillator();
	const gainNode = audioCtx.createGain();
	const panNode = audioCtx.createStereoPanner();

	oscillator.type = 'sine';
	oscillator.frequency.value = frequency;

	gainNode.gain.value = volume;
	panNode.pan.value = pan * 2 - 1; // Convert 0-1 to -1 to 1

	oscillator.connect(gainNode).connect(panNode).connect(audioCtx.destination);
	oscillator.start();
	oscillator.stop(audioCtx.currentTime + duration);
}

// ------------------- Particle Class -------------------
class Particle {
	constructor(){
		this.vx = (Math.random() - 0.5) * 0.5;
		this.vy = (Math.random() - 0.5) * 0.5;
	}
	kineticEnergy() { return 0.5*(this.vx*this.vx + this.vy*this.vy); }
	update(){
		// Small random motion
		this.vx += (Math.random() - 0.5) * 0.02;
		this.vy += (Math.random() - 0.5) * 0.02;
	}
}

// ------------------- Lobe Class -------------------
class Lobe {
	constructor(base_freq, pan, color, index){
		this.particles = [];
		for(let i=0; i<PARTICLES_PER_LOBE; i++){
			this.particles.push(new Particle());
		}
		this.base_freq = base_freq;
		this.pan = pan;
		this.color = color;
		this.index = index;
	}
	update(){
		for(let p of this.particles){
			p.update();
		}
		// Maxwell's Demon: sort particles by energy
		const avg_energy = this.particles.reduce((sum, p) => sum + p.kineticEnergy(), 0) / PARTICLES_PER_LOBE;
		for(let p of this.particles){
			if(p.kineticEnergy() > avg_energy){
				p.vx += 0.01;
			} else {
				p.vx -= 0.01;
			}
		}
	}
	render(ctx, x, y, width, height){
		const lobe_width = width / NUM_LOBES;
		const lobe_x = x + this.index * lobe_width;
		const bar_width = lobe_width * 0.8;
		const bar_x = lobe_x + lobe_width * 0.1;
		
		// Draw lobe background
		ctx.fillStyle = this.color + '20';
		ctx.fillRect(bar_x, y, bar_width, height);
		
		// Draw particles as bars
		const bar_height = height / PARTICLES_PER_LOBE;
		for(let i=0; i<this.particles.length; i++){
			const p = this.particles[i];
			const energy = p.kineticEnergy();
			const bar_alpha = Math.min(1.0, energy * 10);
			ctx.fillStyle = this.color + Math.floor(bar_alpha * 255).toString(16).padStart(2, '0');
			ctx.fillRect(bar_x, y + i * bar_height, bar_width * (0.5 + energy * 5), bar_height * 0.8);
		}
		
		// Draw lobe label
		ctx.fillStyle = this.color;
		ctx.font = '14px Arial';
		ctx.fillText(`${this.base_freq}Hz`, bar_x + 5, y + 15);
	}
}

// ------------------- Main Simulation -------------------
const lobes = [];
for(let i=0; i<NUM_LOBES; i++){
	lobes.push(new Lobe(BASE_FREQUENCIES[i], LOBE_PANS[i], LOBE_COLORS[i], i));
}

function loop(){
	ctx.clearRect(0,0,WIDTH,HEIGHT);
	const dt = 1/FPS;
	
	// Update lobes
	for(let lobe of lobes){
		lobe.update();
	}
	
	// Play particle sounds
	for(let lobe of lobes){
		for(let p of lobe.particles){
			const freq = lobe.base_freq + p.kineticEnergy() * 300;
			const vol = Math.min(1.0, p.kineticEnergy() * 8);
			playTone(freq, vol, lobe.pan);
		}
	}
	
	// Render visualization
	const panel_height = HEIGHT * 0.6;
	const panel_y = HEIGHT * 0.2;
	const panel_width = WIDTH * 0.8;
	const panel_x = WIDTH * 0.1;
	
	for(let lobe of lobes){
		lobe.render(ctx, panel_x, panel_y, panel_width, panel_height);
	}
	
	// Update panel info
	let total_energy = 0;
	for(let lobe of lobes){
		for(let p of lobe.particles){
			total_energy += p.kineticEnergy();
		}
	}
	document.getElementById('panel').innerHTML = `
		<div>Particles per Lobe: ${PARTICLES_PER_LOBE}</div>
		<div>Total Energy: ${total_energy.toFixed(2)}</div>
		<div>Base Frequencies: ${BASE_FREQUENCIES.join(', ')} Hz</div>
	`;
	
	requestAnimationFrame(loop);
}

let loopRunning = false;

// Start audio context on user interaction
function startLoop(){
	if(loopRunning) return;
	loopRunning = true;
	if(audioCtx.state === 'suspended'){
		audioCtx.resume();
	}
	loop();
}

canvas.addEventListener('click', startLoop, {once: true});
document.addEventListener('keydown', startLoop, {once: true});
</script>
</body>
</html>

